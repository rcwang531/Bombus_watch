name: Open PR from data-bot

on:
  push:
    branches: [ data-bot ]

permissions:
  pull-requests: write
  contents: read

jobs:
  pr:
    runs-on: ubuntu-latest
    steps:
      - name: Create PR if missing (data-bot -> main)
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const head = `${owner}:data-bot`;
            const base = 'main';

            const prs = await github.rest.pulls.list({
              owner,
              repo,
              state: 'open',
              head,
              base,
              per_page: 10,
            });

            if (prs.data.length > 0) {
              core.info(`PR already exists: #${prs.data[0].number}`);
              return;
            }

            const created = await github.rest.pulls.create({
              owner,
              repo,
              head: 'data-bot',
              base,
              title: 'Update Bombus visualization (auto)',
              body: 'Automated update from data-bot branch. Please review generated files under /docs.',
            });

            core.info(`Created PR: ${created.data.html_url}`);
